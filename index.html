 <!DOCTYPE html>
<html>
<head>
	<style>
		body {
			overflow: hidden;
		}
		.box {
			width: 50px;
			height: 50px;
			background-color: red;
			float: left;
			margin-left: 10px;
			margin-top: 10px;
		}

		.demo {
			animation: animate 6s linear 0s infinite alternate;
		}

		.header {
			position: fixed;
		}

		@keyframes animate {
			0%   {transform: translateX(0) rotate(0deg) scale(0.6);}
			100% {transform: translateX(500px) rotate(360deg) scale(1.2);}
		}
	</style>
</head>

<body>
	<div class="header">
		<span id="type">CSS Animation</span>
		<button onclick="toggle()">Toggle</button>
		<button onclick="faster()">Faster JS</button>
	</div>
	<script>
		var winWidth;
		var winHeight;
		var divArray = [];
		var divStyleArray = [];
		var offsetArray = [];
		var offsetHeightArray = [];
		window.onload = function() {
			var div;
			var i;
			for (i = 0; i < 1000; i++) {
				div = document.createElement('div');
				div.classList.add('demo');
				div.classList.add('box');
				document.body.appendChild(div);
				divArray[i] = div;
				divStyleArray[i] = div.style;
			}
			getComputedStyle(document.body).width;
			for (i = 0; i < 1000; i++) {
				offsetArray[i] = divArray[i].offsetLeft;
				offsetHeightArray[i] = divArray[i].offsetTop;
			}
			winWidth = window.innerWidth + 100;
			winHeight = window.innerHeight + 100;
		}

		var toggleStatus = true;
		var animationType = document.getElementById('type');
		var i;
		function toggle() {
			if (toggleStatus) {
				animationType.textContent = 'Request Animation Frame';
				for(i = 2; i < document.body.children.length; i++) {
					document.body.children[i].classList.remove('demo');
				}
				id = requestAnimationFrame(animate);
			} else {
				animationType.textContent = 'CSS Animation';
				cancelAnimationFrame(id);
				for(i = 2; i < document.body.children.length; i++) {
					document.body.children[i].classList.add('demo');
				}
			}
			toggleStatus = !toggleStatus;
		}

		var duration = 6000;
		var translateX = 500;
		var rotate = 360;
		var scale = 1.2 - 0.6;
		var start;
		var id;
		function animate(time) {
			if (!start) {
				start = time;
				id = requestAnimationFrame(animate);
				return;
			}

			var progress = (time - start) / duration;
			var x = progress * translateX;
			var transform = 'translateX(' + x + 'px) rotate(' + progress * rotate + 'deg) scale(' + (0.6 + progress * scale ) + ')';

			if (progress >= 1) {
				x = (2 - progress) * translateX;
				transform = 'translateX(' + x + 'px) rotate(' + (2 - progress) * rotate + 'deg) scale(' + (0.6 + (2 - progress) * scale ) + ')';
			}

			if (progress < 2) {
				for(i = 0; i < divArray.length; i++) {
					if (isFaster && (offsetArray[i] + x >= winWidth || offsetHeightArray[i] >= winHeight)) {
						continue;
					}
					divStyleArray[i].transform = transform;
				}
			} else {
				start = null;
			}
			id = requestAnimationFrame(animate);
		}

		var isFaster = false;
		function faster() {
			isFaster = !isFaster;
		}
	</script>
</body>
</html>
